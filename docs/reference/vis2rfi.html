<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>vis2rfi: Visualise 2Way Random Forest Interactions — vis2rfi • vis2rfi</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="vis2rfi: Visualise 2Way Random Forest Interactions — vis2rfi" />

<meta property="og:description" content="The main function that leverages packages forestFloor and plotly in order to
construct a 3d representation of the interaction effects of two variables." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">vis2rfi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/using-vis2rfi.html">Using vis2rfi</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ariKoi/vis2rfi">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>vis2rfi: Visualise 2Way Random Forest Interactions</h1>
    <small class="dont-index">Source: <a href='https://github.com/ariKoi/vis2rfi/blob/master/R/vis2rfi.R'><code>R/vis2rfi.R</code></a></small>
    <div class="hidden name"><code>vis2rfi.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The main function that leverages packages forestFloor and plotly in order to
construct a 3d representation of the interaction effects of two variables.</p>
    
    </div>

    <pre class="usage"><span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>875</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>rsf_sub</span> <span class='kw'>=</span> <span class='fl'>1</span>/<span class='fl'>3</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"*"</span>), <span class='kw'>smoother</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>df</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>4</span>, <span class='fl'>4</span>),
  <span class='kw'>length_out</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>cfcLabel</span> <span class='kw'>=</span> <span class='st'>"Combined FCs"</span>, <span class='kw'>colors</span> <span class='kw'>=</span> <span class='st'>"Blues"</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>highlightcolor</span> <span class='kw'>=</span> <span class='st'>"#ff0000"</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>impInd</th>
      <td><p>Importance index. An integer vector of length 2 containing
the variable order of importance as given by the random forest algorithm.
Integer values should be less than 20 so that the interaction effect between
pairs of features in the top 20 set of random forest importance is shown.
The default is 1:2 or the first two most important features.</p></td>
    </tr>
    <tr>
      <th>ffObj</th>
      <td><p>The object of class forestFloor_regression or forestFloor_multiClass
(where the latter has not been tested yet) obtained after running the
<code><a href='https://www.rdocumentation.org/packages/forestFloor/topics/forestFloor'>forestFloor</a></code> function on a random forest object. See the
corresponding documentation for details.</p></td>
    </tr>
    <tr>
      <th>maxDissim</th>
      <td><p>Whether to subsample the data using a maximum dissimilarity
approach as per the <code><a href='maxDissimProgBar.html'>maxDissimProgBar</a></code> function. Logical. Default is
FALSE.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>An integer value for setting the seed at the subsampling step. Default
is 875. Setting a different seed will snatch a different sample of cases from the
data, thus experimenting with this parameter can produce various visualizations of
from the same pool of data.</p></td>
    </tr>
    <tr>
      <th>rsf</th>
      <td><p>Random sample frequency of the data. Numeric between 0 and 1. Since a
subsampling approach is used, this value is expected to be small (depending on
the data row size), and if chosen large then an error or a warning message is given.
Default is 25% of the data row size.</p></td>
    </tr>
    <tr>
      <th>rsf_sub</th>
      <td><p>Applicable if maxDissim = TRUE. The percentage of rsf which is set
aside for extracting maximally dissimilar cases. Numeric. Default
is 33% of rsf.</p></td>
    </tr>
    <tr>
      <th>scaleXY</th>
      <td><p>Should the variables in the interaction be standardized? Logical.
Default is TRUE.</p></td>
    </tr>
    <tr>
      <th>outer</th>
      <td><p>Further arguments passed to outer function, mainly FUN, as default is "*"
or to multiply the effects. In addition, since effects of 2way interactions are seeked,
this should be a two variable function, else an error is thrown. See the examples section.</p></td>
    </tr>
    <tr>
      <th>smoother</th>
      <td><p>Whether a smoother should be applied to the construction of the 3d 2way
interaction surface. Logical with default FALSE. Currently GAMs are used with the built-in
nonparametric smoothing terms that are indicated by s for smoothing splines. See <code><a href='https://www.rdocumentation.org/packages/gam/topics/gam'>gam</a></code>.
Depending on the nature of the data, the smoother can produce 3d planes that more clearly
show if the 2 way interaction effect is present and how significant it is i.e. the more
vertical the plance the higher the interaction significance.</p></td>
    </tr>
    <tr>
      <th>df</th>
      <td><p>The target equivalent degrees of freedom, used as a smoothing parameter. Similarly
as in <code><a href='https://www.rdocumentation.org/packages/gam/topics/s'>s</a></code>. A numeric vector of length two with default c(4,4).</p></td>
    </tr>
    <tr>
      <th>length_out</th>
      <td><p>The number of equally spaced values within the subsampled range of each
of the two variables forming the interaction. Same as in <code><a href='https://www.rdocumentation.org/packages/base/topics/seq'>seq</a></code>. If NULL
the default length is the row size of the subsample. For even faster but coarser 3d interaction
surfaces, this parameter can be set to a smaller value, as above, in the spirit of
visualisation experimentation.</p></td>
    </tr>
    <tr>
      <th>cfcLabel</th>
      <td><p>A character label of the z-axis in the 3d plot, which corresponds to the
combined feature contribution function as given in the outer argument above. Default value
is "Combined FCs".</p></td>
    </tr>
    <tr>
      <th>colors</th>
      <td><p>Same as in <code><a href='https://www.rdocumentation.org/packages/plotly/topics/plot_ly'>plot_ly</a></code>. Useful for color experimentation.
Defaut is "Blues". Consult this <a href='https://github.com/EmilHvitfeldt/r-color-palettes'>comprehensive list of colors in R</a>.
A few notable options for this parameter, and taken from the above link, are the following:</p><ul>
<li><p>viridis::inferno(n=5)</p></li>
<li><p>grDevices::heat.colors(n=5) or grDevices::rainbow(n=5)</p></li>
<li><p>oompaBase::cyanyellow(5)</p></li>
<li><p>palr::sstPal(5)</p></li>
<li><p>pals::ocean.curl(5)</p></li>
<li><p>scico::scico(10,palette = "berlin") or scico::scico(10,palette = "oleron")</p></li>
</ul></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>Same as in <code><a href='https://www.rdocumentation.org/packages/plotly/topics/plot_ly'>plot_ly</a></code>. Default is 1.</p></td>
    </tr>
    <tr>
      <th>highlightcolor</th>
      <td><p>Same as in <code><a href='https://www.rdocumentation.org/packages/plotly/topics/plot_ly'>plot_ly</a></code>. Default is "#ff0000 ".</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <code><a href='maxDissimProgBar.html'>maxDissimProgBar</a></code> function.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A 3d plotly visualization showing the combined random forest feature
contribution of the two-way interaction. If the run is assigned, similarly an
object of class "plotly" and "htmlwidget".</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>See <code>vignette("vis2rfi")</code> for a tutorial/guide
on how the package can be used.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='maxDissimProgBar.html'>maxDissimProgBar</a></code>, <code><a href='https://www.rdocumentation.org/packages/forestFloor/topics/forestFloor'>forestFloor</a></code>, <code><a href='https://www.rdocumentation.org/packages/plotly/topics/plot_ly'>plot_ly</a></code>, <code><a href='https://www.rdocumentation.org/packages/plotly/topics/add_trace'>add_surface</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><span class='co'># NOT RUN {</span>
<span class='co'># See vignette for a more detailed introduction.</span>

<span class='co'># Using example and data from the forestFloor::forestFloor documentation  --------------------------------</span>

<span class='co'>### Start of forestFloor::forestFloor documentation :</span>
<span class='co'>#3 - binary regression example</span>
<span class='co'>#classification of two classes can be seen as regression in 0 to 1 scale</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>1234</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>forestFloor</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>randomForest</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/data'>data</a></span>(<span class='no'>iris</span>)
<span class='no'>X</span> <span class='kw'>=</span> <span class='no'>iris</span>[-<span class='fl'>1</span>:-<span class='fl'>50</span>,!<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/names'>names</a></span>(<span class='no'>iris</span>) <span class='kw'>%in%</span> <span class='st'>"Species"</span>] <span class='co'>#drop third class virginica</span>
<span class='no'>Y</span> <span class='kw'>=</span> <span class='no'>iris</span>[-<span class='fl'>1</span>:-<span class='fl'>50</span>,<span class='st'>"Species"</span>]
<span class='no'>Y</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/droplevels'>droplevels</a></span>((<span class='no'>Y</span>)) <span class='co'>#drop unused level virginica</span>

<span class='no'>rf</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/randomForest/topics/randomForest'>randomForest</a></span>(
  <span class='no'>X</span>,<span class='no'>Y</span>,
  <span class='kw'>keep.forest</span><span class='kw'>=</span><span class='fl'>TRUE</span>,  <span class='co'># mandatory</span>
  <span class='kw'>keep.inbag</span><span class='kw'>=</span><span class='fl'>TRUE</span>,   <span class='co'># mandatory</span>
  <span class='kw'>samp</span><span class='kw'>=</span><span class='fl'>20</span>,           <span class='co'># reduce complexity of mapping structure, with same OOB%-explained</span>
  <span class='kw'>importance</span>  <span class='kw'>=</span> <span class='fl'>TRUE</span> <span class='co'># recommended, else giniImpurity</span>
)

<span class='no'>ff</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/forestFloor/topics/forestFloor'>forestFloor</a></span>(<span class='no'>rf</span>,<span class='no'>X</span>,
                 <span class='kw'>calc_np</span><span class='kw'>=</span><span class='fl'>TRUE</span>,    <span class='co'># mandatory to recalculate</span>
                 <span class='kw'>binary_reg</span><span class='kw'>=</span><span class='fl'>TRUE</span>) <span class='co'># binary regression, scale direction is printed</span>
<span class='no'>Col</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/forestFloor/topics/fcol'>fcol</a></span>(<span class='no'>ff</span>,<span class='fl'>1</span>) <span class='co'># color by most important feature</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>ff</span>,<span class='kw'>col</span><span class='kw'>=</span><span class='no'>Col</span>)   <span class='co'># plot features</span>

<span class='co'>#interfacing with rgl::plot3d</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/forestFloor/topics/show3d'>show3d</a></span>(<span class='no'>ff</span>,<span class='fl'>1</span>:<span class='fl'>2</span>,<span class='kw'>col</span><span class='kw'>=</span><span class='no'>Col</span>,<span class='kw'>plot.rgl.args</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>size</span><span class='kw'>=</span><span class='fl'>2</span>,<span class='kw'>type</span><span class='kw'>=</span><span class='st'>"s"</span>,<span class='kw'>alpha</span><span class='kw'>=</span><span class='fl'>.5</span>))
<span class='co'># End of forestFloor::forestFloor documentation.</span>

<span class='co'># Note that RGL device is already slow to enlarge and to manipulate, even with only 100 data points.</span>
<span class='co'># In addition, this isn't the most representative example as in practice we might have a larger data set.</span>
<span class='co'># Repeated usage of show3d might even crash the R session.</span>
<span class='co'># Interaction effect : As Petal.Length and Petal.Width both increase in value, their combined contribution</span>
<span class='co'># to the Random Forest prediction also rises.</span>

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>vis2rfi</span>)
<span class='co'># Let's take a 25% subsample of the data, and similarly examine the interaction effect of the first two</span>
<span class='co'># most important variables i.e. as per Random Forest output.</span>
<span class='co'># By default forestFloor sums the feature contributions to obtain the combined contribution. Hence, we</span>
<span class='co'># update the outer value similarly.</span>
<span class='co'># Also we do not standardize the variables so that we can more easily compare to the show3d result.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>))
<span class='co'># ✔ Taking the random subsample. An rsf value of 0.25 corresponds to 25 cases, out of the 100 ones.</span>
<span class='co'># ✔ Computing the 3d visualization.</span>
<span class='co'># ...examining...</span>
<span class='co'># Notes &amp; Diffs :</span>
<span class='co'># - Visualization is a structure-like object composed of various data slices. This is in contrast to a</span>
<span class='co'># single surface object, and as per package premise.</span>
<span class='co'># - Easy to turn around and examine at any angle.</span>
<span class='co'># - Rich in colorfulness and interactivity, since leveraging the plotly package.</span>
<span class='co'># - Contour lines, as well as data point interactivity, help in discovering areas of both low and high</span>
<span class='co'># contribution.</span>
<span class='co'># - The interaction effect is similarly found as before but with an important difference: There are also</span>
<span class='co'># data points exhibiting a high contribution but with both Petal.Length and Petal.Width having mid-to-low</span>
<span class='co'># values. Place for example the mouse cursor on the object's apex and observe the red lined contours appearing on the feature plane.</span>
<span class='co'># Such cases are more evident when viewing the interaction effect in this manner since their contribution is</span>
<span class='co'># not as attenuated as when plotting all of the data.</span>
<span class='co'># The premise underlying *vis2rfi* is that 2 way interaction effects, when viewed as a 3d object as opposed</span>
<span class='co'># to a single surface, can be easier discovered and further examined in a richer manner.</span>
<span class='co'># Furthermore, taking data subsamples and visually experimenting with them is an idea well rooted in</span>
<span class='co'># statistical thinking.</span>

<span class='co'># Let's take a different subsample, by changing the seed.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>007</span>,
        <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>))
<span class='co'># ✔ Taking the random subsample. An rsf value of 0.25 corresponds to 25 cases, out of the 100 ones.</span>
<span class='co'># ✔ Computing the 3d visualization.</span>
<span class='co'>#</span>
<span class='co'># A bit different shape is observed but with similar conclusions to the last plot above. This is due to the</span>
<span class='co'># small size of this data set. In less contrived scenarios the difference would be more intense.</span>

<span class='co'># Taking a random subsample does not guarantee having a variety of contribution values in the subsample.</span>
<span class='co'># To account for this we can use the maxDissim argument so as to include in the subsample data points that</span>
<span class='co'># better span the variety of values observed in the initial data set.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
        <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>))
<span class='co'># Taking the random subsample.</span>
<span class='co'># An rsf value of 0.25 corresponds to 25 cases, out of the 100 ones.</span>
<span class='co'># Taking the random base 0.67 &amp; pool 0.33 subsample percentage of rsf = 0.25 for maxDissim.</span>
<span class='co'># Base subsample size is :</span>
<span class='co'>#   17 cases</span>
<span class='co'># Pool subsample size is :</span>
<span class='co'>#   83 cases</span>
<span class='co'># Computing the maxDissim object.</span>
<span class='co'># Adding to base subsample 8 cases from the pool subsample, for a total of 25 cases.</span>
<span class='co'># Computing the 3d visualization.</span>

<span class='co'># Now the distinction in combined contribution between high and low values of the variables is also</span>
<span class='co'># visible in other parts of the feature plane. Similarly as before, these can be viewed by placing</span>
<span class='co'># the mouse cursor on the 3d object's apex.</span>
<span class='co'># Note also how the depicted object has altered it's structure over these newly identified regions</span>
<span class='co'># of interest at say point (x = 6.9, y = 1.4).</span>
<span class='co'># If we take another data view, by changing the seed value, we can see this distinction a bit better.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>007</span>,
        <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>))
<span class='co'># Taking the random subsample.</span>
<span class='co'># An rsf value of 0.25 corresponds to 25 cases, out of the 100 ones.</span>
<span class='co'># Taking the random base 0.67 &amp; pool 0.33 subsample percentage of rsf = 0.25 for maxDissim.</span>
<span class='co'># Base subsample size is :</span>
<span class='co'>#   17 cases</span>
<span class='co'># Pool subsample size is :</span>
<span class='co'>#   83 cases</span>
<span class='co'># Computing the maxDissim object.</span>
<span class='co'># Adding to base subsample 8 cases from the pool subsample, for a total of 25 cases.</span>
<span class='co'># Computing the 3d visualization.</span>

<span class='co'># Observe how at the same data point i.e. (x = 6.9, y = 1.4), the object's "roof" tilts more vividly</span>
<span class='co'># than in the previous visualisation.</span>

<span class='co'># The main theme of vis2rfi is to repeatedly alter the function's parameters so as to view the 2 way</span>
<span class='co'># contribution from a variety of perspectives, as shown for example here. The added benefit of doing</span>
<span class='co'># this is expected to be more prominent in situations having a larger data size and/or a less easily</span>
<span class='co'># established 2 way contribution to the predicted target.</span>

<span class='co'># Visualising 3d objects can be helpful in extracting detailed insights of an important 2 way contribution.</span>
<span class='co'># Sometimes though we would like to isolate the interaction effect so as obtain a clearer picture, which</span>
<span class='co'># can then be shown to a less technical audience.</span>

<span class='co'># We can portray the effect by a smoothed 3d surface that immediately shows us the important interaction</span>
<span class='co'># and with a tilt towards the variable that contributes the most i.e. Petal.Length here, having a median</span>
<span class='co'># marginal feature contribution of 0.85% as opposed to Petal.Width with a median of -15.34%.</span>

<span class='co'># GAM technology is utilized in order to conduct the smoothing, and the default smoothing parameters in</span>
<span class='co'># argument df are 4 degrees of freedom for each of the features.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>007</span>,
        <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>), <span class='kw'>smoother</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='co'># Taking the random subsample.</span>
<span class='co'># An rsf value of 0.25 corresponds to 25 cases, out of the 100 ones.</span>
<span class='co'># Taking the random base 0.67 &amp; pool 0.33 subsample percentage of rsf = 0.25 for maxDissim.</span>
<span class='co'># Base subsample size is :</span>
<span class='co'>#   17 cases</span>
<span class='co'># Pool subsample size is :</span>
<span class='co'>#   83 cases</span>
<span class='co'># Computing the maxDissim object.</span>
<span class='co'># Adding to base subsample 8 cases from the pool subsample, for a total of 25 cases.</span>
<span class='co'># Fitting the GAM smoothing spline with 4 and 4 degrees of freedom respectively on each of the two interaction variables.</span>
<span class='co'># Computing the 3d visualization.</span>

<span class='co'># More succinctly than without smoothing, the surface's high upwards incline depicts the increase in the</span>
<span class='co'># contribution to the prediction. In addition, the interaction effect has been established with only a</span>
<span class='co'># 25% subset of the data. In many practical applications, this is what is mainly needed to convey the</span>
<span class='co'># message.</span>

<span class='co'># If we would like to further emphasize the interaction effect, we can flatten the 3d surface by lowering</span>
<span class='co'># the smoothing spline degrees of freedom in the GAM fit to unit values i.e.</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>rsf</span> <span class='kw'>=</span> <span class='fl'>0.25</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='fl'>007</span>,
        <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>), <span class='kw'>smoother</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>df</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>,<span class='fl'>1</span>))
<span class='co'># Resulting in a 3d plane for this data set while the tilt towards Petal.Length is more evident.</span>

<span class='co'>## Example with caret:</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/rm'>rm</a></span>(<span class='kw'>list</span><span class='kw'>=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/ls'>ls</a></span>())
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>caret</span>)
<span class='co'># Loading required package: lattice</span>
<span class='co'>#</span>
<span class='co'># Attaching package: ‘caret’</span>
<span class='co'>#</span>
<span class='co'># The following objects are masked from ‘package:vis2rfi’:</span>
<span class='co'>#</span>
<span class='co'>#   minDiss, sumDiss</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>forestFloor</span>)
<span class='no'>N</span> <span class='kw'>=</span> <span class='fl'>1000</span>
<span class='no'>vars</span> <span class='kw'>=</span> <span class='fl'>7</span>
<span class='no'>noise_factor</span> <span class='kw'>=</span> <span class='fl'>.3</span>
<span class='no'>bankruptcy_baserate</span> <span class='kw'>=</span> <span class='fl'>0.2</span>
<span class='no'>X</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/data.frame'>data.frame</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/lapply'>replicate</a></span>(<span class='no'>vars</span>,<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='no'>N</span>)))
<span class='no'>y.signal</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/with'>with</a></span>(<span class='no'>X</span>,<span class='no'>X1</span>^<span class='fl'>2</span>+<span class='no'>X2</span>^<span class='fl'>2</span>+<span class='no'>X3</span>*<span class='no'>X4</span>+<span class='no'>X5</span>+<span class='no'>X6</span>^<span class='fl'>3</span>+<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Trig'>sin</a></span>(<span class='no'>X7</span>*<span class='no'>pi</span>)*<span class='fl'>2</span>) <span class='co'>#some non-linear f</span>
<span class='no'>y.noise</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/Normal'>rnorm</a></span>(<span class='no'>N</span>) * <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/sd'>sd</a></span>(<span class='no'>y.signal</span>) * <span class='no'>noise_factor</span>
<span class='no'>y.total</span> <span class='kw'>=</span> <span class='no'>y.noise</span>+<span class='no'>y.signal</span>
<span class='no'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/factor'>factor</a></span>(<span class='no'>y.total</span><span class='kw'>&gt;=</span><span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/quantile'>quantile</a></span>(<span class='no'>y.total</span>,<span class='fl'>1</span>-<span class='no'>bankruptcy_baserate</span>))

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Random'>set.seed</a></span>(<span class='fl'>1</span>)
<span class='no'>caret_train_obj</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/caret/topics/train'>train</a></span>(
  <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>X</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>y</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"rf"</span>,
  <span class='kw'>keep.inbag</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,  <span class='co'>#always set keep.inbag=TRUE passed as ... parameter to randomForest</span>
  <span class='kw'>ntree</span><span class='kw'>=</span><span class='fl'>50</span>, <span class='co'>#speed up this example, if set too low, forestFloor will fail</span>
)

<span class='no'>rf</span> <span class='kw'>=</span> <span class='no'>caret_train_obj</span>$<span class='no'>finalModel</span> <span class='co'>#extract model</span>
<span class='kw'>if</span>(!<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/all'>all</a></span>(<span class='no'>rf</span>$<span class='no'>y</span><span class='kw'>==</span><span class='no'>y</span>)) <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/warning'>warning</a></span>(<span class='st'>"seems like training set have been resampled, using smote?"</span>)
<span class='no'>ff</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/forestFloor/topics/forestFloor'>forestFloor</a></span>(<span class='no'>rf</span>,<span class='no'>X</span>,<span class='kw'>binary_reg</span> <span class='kw'>=</span> <span class='no'>T</span>)

<span class='co'>#... or simply pass train</span>
<span class='no'>ff</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/forestFloor/topics/forestFloor'>forestFloor</a></span>(<span class='no'>caret_train_obj</span>,<span class='no'>X</span>,<span class='kw'>binary_reg</span> <span class='kw'>=</span> <span class='no'>T</span>)
<span class='fu'><a href='https://www.rdocumentation.org/packages/graphics/topics/plot'>plot</a></span>(<span class='no'>ff</span>,<span class='fl'>1</span>:<span class='fl'>6</span>,<span class='kw'>plot_GOF</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='co'># Using vis2rfi:</span>
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>vis2rfi</span>)
<span class='co'># Focus on the 6th in order of importance variable, having the lowest R-squared value with the 5th one.</span>
<span class='co'># These are the x3 and x4 variables known to interact:</span>
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>6</span>,<span class='fl'>7</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>))
<span class='fu'>vis2rfi</span>(<span class='kw'>impInd</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>6</span>,<span class='fl'>7</span>), <span class='kw'>ffObj</span> <span class='kw'>=</span> <span class='no'>ff</span>, <span class='kw'>scaleXY</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>maxDissim</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>outer</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>FUN</span> <span class='kw'>=</span> <span class='st'>"+"</span>),
        <span class='kw'>smoother</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Ari Koitsanos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

